<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.accenture.masterdata.core.mapper.EmployeeMapper">

	<insert id="inertEmployee" parameterType="com.accenture.masterdata.core.inEntity.EmployeeIn">
    	insert into t_employee (
	    	name, 
	    	eId, 
	    	email,
	      	organizationId, 
	    	<if test="userId != null and userId != ''">
	      	userId, 
	      	</if>
			<if test="cardNo != null and cardNo != ''">
	      	cardNo,
			</if>
			<if test="sex != null and sex != ''">
	      	sex,
			</if>
			<if test="address != null and address != ''">
	      	address,
			</if>
			<if test="tel != null and tel != ''">
	      	tel,
			</if>
			<if test="comment != null and comment != ''">
	      	comment,
			</if>
			<if test="creatorUserId != null and creatorUserId != ''">
	      	creatorUserId,
			</if>
	      	creationTime,
			tenantId
    	) values (
	    	#{name}, 
	    	#{eId}, 
	    	#{email},
	      	#{organizationId}, 
	    	<if test="userId != null and userId != ''">
	      	#{userId}, 
	      	</if>
			<if test="cardNo != null and cardNo != ''">
	      	#{cardNo},
			</if>
			<if test="sex != null and sex != ''">
	      	#{sex},
			</if>
			<if test="address != null and address != ''">
	      	#{address},
			</if>
			<if test="tel != null and tel != ''">
	      	#{tel},
			</if>
			<if test="comment != null and comment != ''">
	      	#{comment},
			</if>
			<if test="creatorUserId != null and creatorUserId != ''">
	      	#{creatorUserId},
			</if>
	      	now(),
			#{tenantId}    	
      	)
  </insert>
  
  <update id="updateEmployee" parameterType="com.accenture.masterdata.core.inEntity.EmployeeIn">
    update t_employee
    <set>
      <if test="name != null and name != ''">
        name = #{name},
      </if>
      <if test="eId != null and eId != ''">
        eId = #{eId},
      </if>
      <if test="email != null and email != ''">
        email = #{email},
      </if>
      <if test="userId != null and userId != ''">
        userId = #{userId},
      </if>
      <if test="organizationId != null and organizationId != ''">
        organizationId = #{organizationId},
      </if>
      <if test="cardNo != null and cardNo != ''">
        cardNo = #{cardNo},
      </if>
      <if test="sex != null and sex != ''">
        sex = #{sex},
      </if>
      <if test="address != null and address != ''">
        address = #{address},
      </if>
      <if test="tel != null and tel != ''">
        tel = #{tel},
      </if>
      <if test="comment != null and comment != ''">
        comment = #{comment},
      </if>
      <if test="tenantId != null and tenantId != ''">
        tenantId = #{tenantId},
      </if>
      <if test="lastModifierUserId != null and lastModifierUserId != ''">
        lastModifierUserId = #{lastModifierUserId},
      </if>
	  lastModificationTime = now()
    </set>
    where
    	id = #{id}
  </update>
  
  <update id="deleteEmployee" parameterType="int">
   update t_employee
   set isDeleted = 1
   where id = #{id}
   </update>
  
  <select id="selectEmployeeList" parameterType="com.accenture.masterdata.core.inEntity.QueryParam" resultType="com.accenture.masterdata.core.outEntity.EmployeeOut">
	SELECT
		ep.id,
		ep.`name`,
		ep.address,
		ep.cardNo,
		ep.`comment`,
		ep.creationTime,
		ep.creatorUserId,
		ep.deleterUserId,
		ep.deletionTime,
		ep.eId,
		ep.email,
		ep.isDeleted,
		ep.lastModificationTime,
		ep.lastModifierUserId,
		ep.organizationId,
		ep.sex,
		ep.tel,
		ep.tenantId,
		ep.userId,
		(select GROUP_CONCAT(`name` separator '-') from t_organization where id in (ep.orgLikeCode))
	FROM
	  t_employee ep
	WHERE
		ep.isDeleted = 0
		<if test=" strParm != null and strParm != ''">
		${strParm}
		</if>
  </select>
  
  <select id="selectEmployeeCount" parameterType="com.accenture.masterdata.core.inEntity.QueryParam" resultType="int">
	SELECT
		count(0)
	FROM
	  t_employee ep
	WHERE
		ep.isDeleted = 0
		<if test=" strParm != null and strParm != ''">
		${strParm}
		</if>
  </select>
  
  <select id="selectEmployeeList" parameterType="com.accenture.masterdata.core.inEntity.QueryParam" resultType="com.accenture.masterdata.core.outEntity.EmployeeOut">
	SELECT
		ep.id,
		ep.`name`,
		ep.address,
		ep.cardNo,
		ep.`comment`,
		ep.creationTime,
		ep.creatorUserId,
		ep.deleterUserId,
		ep.deletionTime,
		ep.eId,
		ep.email,
		ep.isDeleted,
		ep.lastModificationTime,
		ep.lastModifierUserId,
		ep.organizationId,
		ep.sex,
		ep.tel,
		ep.tenantId,
		ep.userId,
		(select GROUP_CONCAT(`name` separator '-') from t_organization where id in (ep.orgLikeCode))
	FROM
	  t_employee ep
	WHERE
		ep.isDeleted = 0
		<if test=" id != null and id != ''">
			id = #{id}
		</if>
  </select>
</mapper>